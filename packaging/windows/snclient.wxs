<?xml version="1.0" encoding="utf-8"?>
<?if $(var.Platform) = x64 ?>
  <?define PlatformProgramFilesFolder = "ProgramFiles64Folder" ?>
  <?define Win64 = 'yes' ?>
<?else ?>
  <?define PlatformProgramFilesFolder = "ProgramFilesFolder" ?>
  <?define Win64 = "no" ?>
<?endif ?>
<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>
  <Product
	Name="SNClient+"
	Id="*"
	UpgradeCode="F4BF03F6-D3DA-44FF-A444-9B64119DA0CE"
	Language='1033'
	Codepage='1252'
	Version='$(var.MajorVersion).$(var.MinorVersion).$(var.RevisionNumber)'
	Manufacturer='Sven Nierlein'
	>
	<Package InstallScope="perMachine" InstallerVersion="200" Compressed="yes" />

	<MajorUpgrade AllowDowngrades="yes" />
	<Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
	<WixVariable Id="WixUILicenseRtf" Value="packaging\windows\LICENSE.rtf" />
    <UI Id="MyWixUI_InstallDir">
      <UIRef Id="WixUI_InstallDir" />
    </UI>

	<MediaTemplate EmbedCab="yes" />
	<Directory Id='TARGETDIR' Name='SourceDir'>
	  <Directory Id="$(var.PlatformProgramFilesFolder)">
		<Directory Id='INSTALLDIR' Name='snclient'>

			<Component Id='MainExecutable' Guid='B74E8F62-9C75-4C20-8128-3E5CBA81D6D9' Win64="$(var.Win64)">
				<File Id='SNClientExe' Name='snclient.exe' DiskId='1' Source='snclient.exe' KeyPath='yes' />
				<ServiceInstall
					Description='SNClient+ (Secure Naemon Client) is a secure general purpose monitoring agent.'
					ErrorControl='ignore'
					Arguments="winservice"
					Name = 'snclient'
					Id='SNClientService'
					Interactive='no'
					Start='auto'
					Type='ownProcess'
					Vital='no'
				/>
				<ServiceControl
					Id='StartSNClientService'
					Start='install'
					Stop='both'
					Remove='uninstall'
					Name='snclient'
					Wait='no'
				/>

			</Component>

			<Component Id='SampleCaCertificate' Guid='5754CA78-7BEF-44B2-A01B-9C156E7C859B' NeverOverwrite='yes'>
			  <File Id='cacertPem' Name='cacert.pem' DiskId='1' Source='cacert.pem' KeyPath='yes' />
			</Component>

			<Component Id='SampleConfigurationIni' Guid='E64B4DBF-C6CF-41E5-9032-6D83C39B9323' NeverOverwrite='yes'>
			  <File Id='snclientIni' Name='snclient.ini' DiskId='1' Source='snclient.ini' KeyPath='yes' />
			</Component>

			<Component Id='SampleServerCertificate' Guid='F58FD191-91AA-4F97-9FD8-78E2AE509AA7' NeverOverwrite='yes'>
			  <File Id='serverCrt' Name='server.crt' DiskId='1' Source='server.crt' KeyPath='yes' />
			</Component>

			<Component Id='SampleServerKey' Guid='D06D3104-E240-4A11-BC54-62CB5FBD6AD5' NeverOverwrite='yes'>
			  <File Id='serverKey' Name='server.key' DiskId='1' Source='server.key' KeyPath='yes' />
			</Component>

			<Component Id='LicenseFile' Guid='384396D1-F506-4AF4-B3D3-D2CEC9E881F5'>
			  <File Id='license' Name='LICENSE' DiskId='1' Source='LICENSE' KeyPath='yes' />
			</Component>

			<Component Id='ReadmeFile' Guid='E1AA1ABC-B488-4083-95B1-B46ABF0EC591' Win64="$(var.Win64)">
			  <File Id='readmeMd' Name='README.md' DiskId='1' Source='README.md' KeyPath='yes' />
			</Component>

		  </Directory>
	  </Directory>
	</Directory>

	<Feature Id='Complete' Level='1'>
	  <ComponentRef Id='MainExecutable' />
	  <ComponentRef Id='SampleCaCertificate' />
	  <ComponentRef Id='SampleConfigurationIni' />
	  <ComponentRef Id='SampleServerCertificate' />
	  <ComponentRef Id='SampleServerKey' />
	  <ComponentRef Id='LicenseFile' />
	  <ComponentRef Id='ReadmeFile' />
	</Feature>
  </Product>
</Wix>
